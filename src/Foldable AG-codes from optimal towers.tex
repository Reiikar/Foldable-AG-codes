\documentclass[10pt]{article}

\input{header.tex}

\title{Families of codes from tower of curves which are compatible with proximity testing}

\author{Sarah Bordage, Mathieu Lhotel, Jade Nardi, Hugues Randriam}

\begin{document}

\maketitle


\tableofcontents
\newpage

\section{Introduction}

\s

The main purpose of this paper is to find new families of algebraic geometry codes (AG in short) that are compatible with proximity testing. This idea follows from \cite{IOPP}, where explicit codes on a curve of Kummer type and an Hermitian tower are proposed and used to build an efficient AG-IOPP. The problem of proximity testing to an error-correcting code $\calC$ consists in distinguishing between the case where an input word belongs to $\calC$ an the one where it is far from every codeword of $\calC$. On the other side, AG-codes are good candidates to construct short proof systems (PCP's, FRI's protocole (see \cite{FRI}),...). The main contribution of this paper is to propose families of AG-codes constructed from a tower of curves, that is over polylogarithmic-size alphabet. In particular, we focus on optimal towers, (see \cite{GS} for more details), that looks promising in order to have assymptotics properties. The counterpart is that in order to obtain foldables codes, we will have to relax the foldable conditions introduced in \cite{IOPP}, in particular divisor compatibility (see Definition 4.3).

\s

In the first place, we will focus on the optimal tower defined over $\mathbb{F}_{q^2}$ by the recursive equation 
\begin{equation} 
y^2 = \dfrac{x^2+1}{2x}.
\end{equation} It has been proven to be optimal in \cite{GS}. Furthermore, this tower turn out to be also modular, and comes from the tower of modular curves $X_0(2^n)$ (see \cite{ELKS}). 

\s

\section{Preliminarie results}

\s

\subsection{Function fields, Places and Divisors}

\s

\begin{def1} \label{floor divisor}
Let $D = \sum\limits_{P \in \rm Supp\it (D)} n_P P \in \rm Div \it(F)$ a divisor on a function field $F$, and $\ell \in \mathbb{N}$. We define the floor divisor $\left\lfloor \dfrac{1}{\ell}D \right\rfloor$ by 
\[ \left\lfloor \frac{1}{\ell}D \right\rfloor := \sum\limits_{P \in \rm Supp \it (D)} \left\lfloor \frac{n_P}{\ell} \right\rfloor P.\]
\end{def1}

\s

\subsection{Splitting Riemann-Roch spaces according to a cyclic automorphism group}

\s

The first requirement to make a sequence of foldable AG-codes is the splitting of Riemann-Roch spaces. The idea is to try to use Kani's theorem (see \cite{K86}) in our specific framework. Let us describe it. \\
Let $\calX$ be a smooth irreducible curve over a finite field $\bbF_q$ and let $\calG$ be a cyclic group generated by an element $\gamma$ of order $m$, acting on the curve $\calX$. Let $\xi \in \overline{\bbF}_q$ be a primitive $m^{th}$ root of unity lying in some algebraic closure of $\bbF_q$. Set $\mathcal{Y} := \calX/\calG$ and denote by $\pi : \calX \rightarrow \mathcal{Y}$ the canonical projection morphism. For a fixed divisor $D \in \rm Div \it (\calX)$, we want to exhibit a relation between the Riemann-Roch space $L_{\calX}(D)$ and some Riemann-Roch spaces on the quotient curve $\mathcal{Y}$. The group $\calG$ acts on the vector space $L_{\calX}(D)$ via $\gamma \cdot f = f \circ \gamma$. By the representation theory, it is well-known that we can write
\[L_{\calX}(D) = \bigoplus\limits_{j=0}^{m-1} L_{\calX}(D)_j ,\]
where $L_{\calX}(D)_j := \{ f \in L_{\cal_X}(D) \ | \ \gamma \cdot f = \xi^jf\}$.


\s

\begin{theorem} \rm (see \cite{K86}). \it \label{Kani}
Assume $\calG = \langle \gamma \rangle$ is cyclic of order $m$, coprime with $|\bbF_q|$. Then 
\begin{enumerate}
\item There exists a function $\mu \in \overline{\bbF}(\calX)$ such that $\gamma \cdot \mu = \xi\mu$.
\item For any $\calG$-invariant divisor $D \in \rm Div \it (\calX)$, when considering Riemann-Roch spaces over $\overline{\bbF}$, we have 
\begin{equation} \label{deckani}
L_{\calX}(D)_j \otimes \overline{\bbF}_q \simeq \mu^j\pi^{*}\left(L_{\mathcal{Y}}\left(\left\lfloor \dfrac{1}{m} \pi_*(D+j \cdot (\mu)^{\mathcal{Y}}\right\rfloor \right) \otimes \overline{\bbF}_q \right).
\end{equation}
\end{enumerate}
\end{theorem}

\s

\begin{rq1} \rm
If the function $\mu$ is defined over the base field $\bbF_q$, then the decomposition (\ref{deckani}) is actually valid when considering $\bbF_q$-vector spaces, ie:
\[L_{\calX}(D)_j \simeq \mu^j\pi^{*}\left(L_{\mathcal{Y}}\left(\left\lfloor \dfrac{1}{m} \pi_*(D+j \cdot (\mu)^{\mathcal{Y}}\right\rfloor \right) \right).\]
In practical instantiations, we are always able to choose $\mu$ defined over $\bbF_q$; that is such a decomposition holds even if $\fq$ doesn't contain $m^{th}$ primitive root of unity. However, keep in mind that in our settings, it will always be true.
\end{rq1}

\s

\section{Settings of AG-codes compatible with proximity testing}

\s

In this section, we display a workable setting for the construction of an IOPP system to test proximity to an AG-code. It is very similar to the one introduced in \cite{IOPP}, and we will point out the main changes when necessary. The main idea is still the same, ie. reduce the problem of testing proximity to a smaller code. To this end, we introduice a sequence of suitable AG-codes of decreasing length.

\s

\subsection{Recursive tower of curves}

\s

Throughout this paper, we will be dealing with recursive tower of curves, wihch actually corresponds to a recursive tower of function fields. Le us explicit the definition.

\s

\begin{def1} \label{recursive tower}
Let $\calF= (F_i)_{i\geq 0}$ be a tower of function fields defined over some finite field $\fq$, with $F_0=\fq(x_0)$ the rational function field. We say that $\calF$ is recursive if there exist $f(X,Y) \in \fq[X,Y]$ and functions $x_i \in F_i$ such that 
\begin{enumerate}
\item $f$ is separable in $X$ and $Y$;
\item $F_{i+1}=F_i(x_i)$ and $f(x_i,x_{i+1})=0$ for every $i \geq 0$;
\item $[F_{i+1}:F_i] = \rm deg_{\it Y} \it (f(X,Y))$, for every $i \geq 0$.
\end{enumerate}
We say that $\calF$ is recursively defined by the equation
\[f(X,Y)=0.\]
\end{def1}

Now, consider a sequence of curves $(\calX_i)_{i \geq 0}$ over $\fq$ such that the function field $\calX_i(\fq)$ of $\calX_i$ is noting but $F_i$. We then get a sequence of covers 

\begin{equation} \label{sequence of curves}
\cdots \twoheadrightarrow \calX_{i+1} \overset{\pi_i}{\twoheadrightarrow} \calX_i \twoheadrightarrow \cdots \twoheadrightarrow \calX_1 \overset{\pi_1}{\twoheadrightarrow} \calX_0,
\end{equation}
where $\pi_i : \calX_{i+1} \twoheadrightarrow \calX_i$ is the canonical projection.

It is well known (see \cite{GS}) that a lot of properties along a recursive tower comes from its basic function field.

\s

\begin{def1} \label{basic function field}
Let $\calF$ be a tower of function field recursively defined by the equation $f(X,Y)=0$. The basic function field of $\calF$ is the field $F=\fq[x,y]$ such that $f(x,y)=0$. In particular, one have $[F:\fq(x)]=\rm{deg}_{\it Y}\it (f(X,Y))$.
\end{def1} 

\s

From now on, we will deal with recursive towers whose basic function field is a cyclic extension of the rational function field $\fq(x)$. In particular, from the recursive defintion, each extension $F_{i+1}/F_i$ is also cyclic of order $\ell$ (not necessary a prime). Denote by $\calG := Gal(F/\fq(x)) \simeq \Z/\ell \Z$. Then in the sequence (\ref{sequence of curves}), we have 
\[ \calX_{i} := \calX_{i+1}/\calG, \ \forall \ i \geq 0,\]
ie. the group $\calG$ acts the same way on each curve in the sequence. Such a sequence of curve will be denoted a \it $(\calX_i,\calG)$-sequence \rm.  \\
In particular, if we are given a curve $\calX_{\ii}$ for some $\ii \geq 0$, the solvable group $\calG_{\ii} := \Z/\ell^{\ii}\Z$ acts on $\calX_{\ii}$, and is such that $\calX_0 \simeq \calX_{\ii}/\calG_{\ii}$.

\s

\subsection{Sequence of codes}

\s

Let $(\calX_i)_{i \geq 0}$ be a $(\calX_i,\calG)$-sequence of curves over $\fq$ as above. Let $\ii \geq 0$ be an indice that represent the curve we're given a AG-code on. In particular, we want to test the proximity of a code 
\[C_{\ii} := C_L(\calX_{\ii},\calP_{\ii},D_{\ii}).\]
For any $i \in \{0,...,\ii\}$, we aim to define an AG-code 
\[C_i := C_L(\calX_i,\calP_i,D_i)\]
on the curve $\calX_i$, such that this problem of proximity testing can be reduced at each step to a proximity test to a smaller code $C_i$. The rest of this section is dedicated to the choice of the set of evaluation points $\calP_i$ and the divisor $D_i$.

\s

\subsubsection{Evaluation points}

\s

From a set of points $\calP_{\ii}$, we want to define a sequence of set of points $(\calP_i) \subseteq \calX_i(\fq)$ recursively by $\calP_i := \pi_i(\calP_{i+1})$. For our protocol, as in the one proposed in \cite{IOPP}, we need for each $i \in \{0,...,\ii-1\}$ that each point in $\calP_i$ admits exactly $\ell := \#\calG$ preimages under $\pi_i$. Since the last curve $\calX_0$ is isomorphic to the quotient $\calX_{\ii}/\calG_{\ii}$, it is necessary and sufficient that the first set $\calP_{\ii}$ of evaluation points is a union of disjoint orbits of size $\#\calG_{\ii} = \ell^{\ii}$, ie. $\calG_{\ii}$ acts freely on $\calP_{\ii}$.

\s

\subsubsection{Compatible divisors}

\s

Fix a divisor $D_{\ii} \in \rm Div \it (\calX_{\ii})$ that is globally under the action of $\calG_{\ii}$, as we did for the support $\calP_{\ii}$. To make our protocol complete and sound, we need the sequence of divisors $(D_i)$ to have the following properties:

\begin{enumerate}
\item Each divisor $D_i$ is supported by $\calG$-invariant points (so that its support doesn't intersect $\calP_i$);
\item Each Riemann-Roch space $L_{\calX_i}(D_i)$ admits a nice decomposition in terms of explicits divisor on the curve $\calX_{i-1}$ (see Definition \ref{partitions of riemann spaces} below);
\item For each $1 \leq i \leq \ii$, the divisor $D_{i-1}$ needs to be compatible with the divisor $D_i$ and the decomposition of its Riemann-Roch space (this important part will be detailled later).
\end{enumerate}

\s

\begin{def1} \label{partitions of riemann spaces}
Let $i \in \{1,...,\ii\}$. Fix a divisor $D_i \in \rm Div \it (\calX_i)$ and a function $\mu_i \in F_i$. We say that $\mu_i$ partitions $L_{\calX_i}(D_i)$ (with respect to the action of $\calG$) if it admits a decomposition of the form
\begin{equation}
L_{\calX_i}(D_i) = \bigoplus\limits_{j=0}^{\ell -1} \mu_i^j \pi_{i-1}^*\left(L_{\calX_{i-1}}(E_{i,j})\right),
\end{equation}
where $E_{i,j} := \left\lfloor \dfrac{1}{\ell} \pi_{i*}(D_i+j \cdot (\mu_i)^{F_i})\right\rfloor \in \rm Div \it (\calX_{i-1})$ for $j \in \{0,...,\ell -1\}$, where the floor function of a divisor id defined in Definition \ref{floor divisor}.
\end{def1}

\s

\begin{rq1} \rm
Note that a function $\mu_i$ as in the above definition can by provided by Theorem \ref{Kani}, as it is the case in the Kummer settings (see \cite{IOPP} for more details). Nevertheless, such decomposition may exist without the hypotheses of Kani's theorem, as it is the case if the characteristic of $\bbF_q$ divides $\#\calG$ (see the settings proposed on the Hermitian tower in \cite{IOPP}).
\end{rq1}

\s

Let us now define the notion of compatible divisors, which actully is a bit relaxed compared to the one in \cite{IOPP}, since we can not verify the previous definition in the optimal tower settings.

\s

\begin{def1} \label{compatible}
Let $i \in \{1,...,\ii\}$. Fix a divisor $D_i \in \rm Div \it (\calX_i)$ and a function $\mu_i \in F_i$ that partitions $L_{\calX_i}(D_i)$. A divisor $D_{i-1} \in \rm Div \it (\calX_{i-1})$ is said to be comptatible with $(D_i,\mu_i)$ if there exist functions $f_{i-1,j} \in F_{i-1}$ such that the following holds
\begin{enumerate}
\item For every $j \in \{0,...,\ell-1\}$, $D_{i-1} +(f_{i-1,j})^{F_{i-1}} \geq E_{i,j}$,
\item For every $j \in \{0,...,\ell-1\}$, there exist a function $\nu_{i-1,j} \in F_{i-1}$ such that 
\begin{equation}
(\nu_{i-1,j})^{F_{i-1}}_{\infty} = D_{i-1}-E_{i,j} + (f_{i-1,j})^{F_{i-1}}.
\end{equation}
\end{enumerate}
\end{def1}

Note this definition coincides with the one in \cite{IOPP}, with a bit more restrictions since we can not directly choose $D_{i-1}$ comparable with the $E_{i,j}$. Nota that the first requirement ensures that $L(E_{i,j}) \subseteq L(D_{i-1} + (f_{i-1,j})^{F_{i-1}})$, and the second one means that for every function $g_j \in L(E_{i,j})$, the function $\nu_{i-1,j}g_j \in L(D_{i-1} + (f_{i-1,j})^{F_{i-1}})$. This will be useful later on. \\
We conclude this section by recalling the definition of foldable AG-code (actually the same as \cite{IOPP}, see Definition 4.5).

\s

\begin{def1} \fr{copié-collé ?} \\
Let $\calC = C_L(\calX_{\ii},\calP_{\ii},D_{\ii})$ be an AG-code. This code is said to be foldable if \begin{enumerate}
\item There exists a finite solvable group $\calG^* \in Aut(\calX_{\ii})$ that acts freely on the support $\calP_{\ii}$. Actually, as in section 3.1, $\calG^*$ will have the form $\calG^* \simeq \Z/\ell^{\ii}\Z$, where $\ii$ is an integer. As a result, a composition series of $\calG^*$ is made of $\ii$ copies of $\calG \simeq \Z/\ell\Z$, and give rises to a $(\calX_i,\calG)$ sequence of curves;
\item There exists $e \in (0,1)$ such that $|\calG^*| = \ell^{\ii} > |\calP_{\ii}|^e$; 
\item There exists some sequences of functions $(\mu_i) \in F_i$ and $(D_i \in \rm Div \it(\calX_i)$ for $i \in \{0,\ii\}$, such that for every $i \in \{1,...,\ii\}$
\begin{itemize}
\item[-] $D_i$ is $\calG$-invariant;
\item[-] $\mu_i$ partitions the Riemann-Roch space $L_{\calX_i}(D_i)$;
\item[-] $D_{i-1}$ is $(D_i,\mu_i)$-compatible (see Definition \ref{compatible}).
\end{itemize}
\end{enumerate}
\end{def1}

\s



\section{The modular tower $X_0(2^n)$}

\s


As an application of our theory of foldable AG-code, we aim to apply it on a well-known recursive tower of curves, that turns out to come from the modular tower $X_0(2^n)$. \\
Let us denote by $\calF = (F_i)$ this tower, defined over a finite field $\mathbb{F}_{q^2}$ swith square cardinality, ie. $q=p^{s}$ with $p = \rm char \it (\fq)$. It is recursively defined by 
\[ F_0 = \fq(x_0) \ \rm{is \ the \ rational \ function \ field}\]
and
\begin{equation} \label{defining equation}
F_i = F_{i-1}(x_i), \ \rm with \ \it x_i^2=\dfrac{x_{i-1}^2+1}{2x_{i-1}}.
\end{equation}

\s

\subsection{Ramification and genus}

\s

This firest subsection is dedicated to the study of the ramification in the tower $\calF$, a well as a formula for the genus $g_i = g(F_i)$ at each stage of the tower. You can find a proof for those result in \cite{NOQ} \\
Note that each extension $F_{i+1}/F_{i}$ is a degree 2 Kummer extension, and is thus well-studied (see for exemple \cite{Sti}). The main goal of the upcomming results is to describes the divisor $(x_i)^{F_i}$ for every $i \geq 0$.

\s

\begin{lemma} \label{ramification}
Let $i \geq 0$. For a place $P \in \mathbb{P}_{F_i}$ and one of its extension $Q \in \mathbb{P}_{F_{i+1}}$, one have 
\begin{equation*}
e(Q|P) = \left\{ \begin{array}{ll}
2 \ \rm if \  \nu_P\left(\it \dfrac{x_i^2+1}{2x_i}\right) \rm \equiv 1 \ [2] ;\\
1 \ \rm if \  \nu_P\left(\it \dfrac{x_i^2+1}{2x_i}\right) \rm \equiv 0  \ [2]. 
\end{array}
\right.
\end{equation*}
\end{lemma}

\s

\begin{proof}
\cite{NOQ}, Lemma 2.1.
\end{proof}

\s

For the remaining of this section, for every $\alpha \in \fq \cup \{\infty\}$, we will denote by $P_{\alpha}^{(0)}$ the unique zero of $x_0-\alpha \in \mathbb{P}_{F_0}$. From Lemma \ref{ramification}, one gets

\s

\begin{corollary} Fix $i\geq 1$.
\begin{enumerate}
\item The places $P_{\infty}^{(0)},P_{0}^{(0)},P_{i}^{(0)},P_{-i}^{(0)}$ are totally ramified in $F_i/F_0$. If we denote by $P_{\infty}^{(i)},P_{0}^{(i)},P_{i}^{(i)},P_{-i}^{(i)}$ their corresponding unique extension in $\mathbb{P}_{F_i}$, we have
\begin{itemize}
\item[(i)] $\nu_{P_{\infty}^{(i)}}(x_i)=-1$
\item[(ii)] $\nu_{P_{\infty}^{(i)}}(x_i) = \left\{ \begin{array}{ll}
1 \ , \ i=0 \\
-1 \ , \ i \geq 1
\end{array} 
\right.$
\item[(iii)] $\nu_{P_{\pm i}^{(i)}}(x_i) = \left\{ \begin{array}{lll}
0 \ , \ i=0 \\
1 \ , \ i = 1 \\
-1 \ , \ i \geq 2.
\end{array} 
\right.$
\end{itemize}
\item The place $P_1^{(i-1)} \in \mathbb{P}_{F_{i-1}}$ totally splits in $F_{i}$. Its two extensions are $P_1^{(i)}$ and $P_{-1}^{(i)} \in \mathbb{P}_{F_{i}}$ and satisfy
\[x_{i}(P_1^{(i)}) = 1 \ \ and  \ \ x_{i}(P_{-1}^{(i)}) = -1.\] 
\end{enumerate}
\end{corollary}

\begin{proof}
\cite{NOQ}, Lemma 2.2, (a) and (b).
\end{proof}

\s

The crucial point now is the suty of the ramification of the point $P_{-1}^{(0)}$ in the tower, since it produces most of the pôles of the function $x_i$ at each stage of the tower.

\s

\begin{lemma} \label{ext P moins 1}
Fix $i \geq 1$. 
\begin{enumerate}
\item $P_{-1}^{(i-1)}$ totally splits in $F_i$, its two extensions being $Q_i^{(i)}$ and $Q_{-i}^{(i)}$. Moreover, theses two places are the only zeroes of the function $1+x_i^2 \in F_i$, and $\nu_{Q_{\pm i}^{(i)}}(1+x_i^2) = 2^i$;
\item Let $r \geq 0$, and denote by $Q_r^{(i)}|P_{-1}^{(r)}$ an extension of $P_{-1}^{(r)}$ in $F_i$. There are two cases :
\begin{itemize}
\item[(i)] If $0 \leq r \leq \lfloor \frac{i-3}{2} \rfloor$ (note that $i \geq 3$ and $r<i-1$), then we have $Q_r^{(i)}|Q_r^{(i-1)}$, with $e(Q_r^{(i)}|Q_r^{(i-1)}) =2$ and 
\[\nu_{Q_r^{(i)}}(x_i)=-1.\]  
Moreover, the sum of the degrees of such places is $2^{r+2}$.
\item[(ii)] If $\lfloor \frac{i-1}{2} \rfloor \leq r \leq i-2$ (note that $i \geq 2$ and $r\geq 0$), then we have $Q_r^{(i)}|Q_r^{(i-1)}$, with $e(Q_r^{(i)}|Q_r^{(i-1)}) =1$ and
\begin{equation*}
\nu_{Q_r^{(i)}}(x_i) = \left\{ \begin{array}{ll}
-2^{2r-i+2} \ , \ r \leq i-3 \\
-2^{i-2} \ , \ r =i-2.
\end{array}
\right.
\end{equation*} 
Moreover, the sum of the degrees of such places is $2^{i-r}$.
\end{itemize}
\end{enumerate}
\end{lemma}

\s

\begin{proof}
\cite{NOQ}, Lemma 2.2, (c) and (d).
\end{proof}

\s

We know have studied all the ramification in the tower, as claimed in the following Corollary.

\begin{corollary}
Let $\mathcal{R}:= \left\{P_0^{(0)},P_{\infty}^{(0)},P_{\pm i}^{(0)},P_{\pm 1}^{(0)}\right\} \subseteq \mathbb{P}_{F_0}$. Then the functions $x_i$ have no zeros nor poles in $F_i$ outside the set of places over $\mathcal{R}$, and those places are all described in previous lemmas.
\end{corollary}

\s

\begin{def1} \label{divisors D's} For any $i \geq 0$ and $0 \leq r \leq i$, denote by
\[D_r^{(i)} := \sum\limits_{Q_r^{(i)}|P_{-1}^{(r)}} Q_r^{(i)}\]
the divisor in $F_i$ given by the sum of places that lie over $P_{-1}^{(r)}$ (which is a place in $F_r$). Note that $D_i^{(i)} = P_{-1}^{(i)}$. \\
We can extend the definition for $r=-2$ and $r=-1$ by setting $D_{-2}^{(i)} := P_0^{(i)}$ and $D_{-1}^{(i)} := P_i^{(i)} + P_{-i}^{(i)}$.
\end{def1}

\s

Note that the places introduced above are all distincts, except for $Q_{\pm i}^{(0)} = P_{\pm i}^{(0)}$. 
From lemma \ref{ext P moins 1}, we have

\s

\begin{corollary} \label{deg et ram D_r}
\begin{enumerate}
\item For any $i \geq 0$ and any $r$ with $-2 \leq r \leq i$, we have 
\begin{equation*}
\rm deg \it (D_r^{(i)}) = \left\{ \begin{array}{ll}
2^{i-r} \ , \ if \ i \leq 2r+2 \\
2^{r+2} \ , \ if \ i \geq 2r+2.
\end{array}
\right.
\end{equation*}
\item If $i \geq 1$ and $r$ is such that $-2 \leq r \leq i$, then a place in \rm Supp($D_r^{(i)}$) ramifies in $F_i/F_{i-1}$ if and only if $i \geq 2r+3$.
\end{enumerate}
\end{corollary}

\s

We know have all the tools recquired to study the principal divisor of functions we will need later on. 

\s

\begin{proposition} \label{div principaux}
\begin{enumerate}
\item We have $(x_0)^{F_0} = P_0^{(0)} - P_{\infty}^{(0)}$, $(x_1)^{F_1} = D_{-1}^{(1)} - P_0^{(1)} - P_{\infty}^{(1)}$ and 
\begin{equation*}
(x_i)^{F_i} = 2^{i-2}D_{i-2}^{(i)} - P_{\infty}^{(i)} - \sum\limits_{r=-2}^{\lfloor \frac{i-3}{2}\rfloor} D_r^{(i)} - \sum\limits_{r=\lfloor \frac{i-1}{2}\rfloor}^{i-3} 2^{2r-i+2}D_r^{(i)}, \ \rm if \it \ i\geq 2.
\end{equation*}
\item We have $(1+x_0)^{F_0} = P_{-1}^{(0)} - P_{\infty}^{(0)}$, $(1+x_1)^{F_1} = 2P_{-1}^{(1)} - P_0^{(1)} - P_{\infty}^{(1)}$ and 
\begin{equation*}
(1+x_i)^{F_i} = 2^{i}P_{-1}^{(i)} - P_{\infty}^{(i)} - \sum\limits_{r=-2}^{\lfloor \frac{i-3}{2}\rfloor} D_r^{(i)} - \sum\limits_{r=\lfloor \frac{i-1}{2}\rfloor}^{i-3} 2^{2r-i+2}D_r^{(i)}, \ \rm if \it \ i\geq 2.
\end{equation*}
\item We have $(1+x_0^2)^{F_0} =  D_{-1}^{(0)} - 2P_{\infty}^{(0)}$, $(1+x_1^2)^{F_1} = 2D_{0}^{(1)} - 2P_0^{(1)} - 2P_{\infty}^{(1)}$ and 
\begin{equation*}
(1+x_i^2)^{F_i} = 2^{i}D_{i-1}^{(i)} - 2P_{\infty}^{(i)} - 2\sum\limits_{r=-2}^{\lfloor \frac{i-3}{2}\rfloor} D_r^{(i)} - \sum\limits_{r=\lfloor \frac{i-1}{2}\rfloor}^{i-3} 2^{2r-i+3}D_r^{(i)}, \ \rm if \it \ i\geq 2.
\end{equation*}
\end{enumerate}
\end{proposition}

\s

\begin{proof}
\cite{NOQ}, Proposition 2.5
\end{proof}

\s

Since we have studied all the ramification in the tower $\mathcal{F}$, we are now able to produce a formula for the genus of the function field $F_i$ pour any $i \geq i$, as a consequence of the Riemann-Hurwitz Theorem.

\s

\begin{proposition}
For $i \geq 0$, the genus of $F_i$ is given by 
\begin{equation*}
g_i := g(F_i) = \left\{ \begin{array}{ll}
(2^{\frac{i+1}{2}}-1)(2^{\frac{i-1}{2}}-1) \ , \ \rm if \ \it j \equiv \rm 1[2] \\
(2^{\frac{i}{2}}-1)^2 \ , \ \rm if \ \it j \equiv \rm 0[2].
\end{array}
\right.
\end{equation*}
\end{proposition}

\s

\begin{proof}
\cite{NOQ}, Proposition 2.6
\end{proof}

\s

Let us conclude this sectin with an easy Corollary that will be useful later on.

\s

\begin{corollary} \label{genus}
For $i\geq 3$, we have
\begin{equation*}
2g(F_i) = \left\{ \begin{array}{ll}
2^{i+1}-3^{\frac{i+1}{2}}+2 \ , \ \rm if \ \it j \equiv \rm 1[2] \\
2^{i+1}-2^{\frac{i+4}{2}} +2\ , \ \rm if \ \it j \equiv \rm 0[2].
\end{array}
\right.
\end{equation*}
\end{corollary}


\s

\subsection{Splitting of Riemann-Roch spaces}

\s

In order to construct a sequence of foldables AG-codes in the tower $\calF$, we make the choice to deal with one-point divisors. In particulatr, fix an integer $\ii \geq 0$ such that we want to test the proximity of vectors to an AG-code $\calC_{\ii}$ on the curve $\calX_{\ii}$, whose function field is $F_{\ii}$. If we follow notations as in 3.1 for the tower $\calF$, we have $\calG \simeq \Z/2\Z$ and $\calG_{\ii} \simeq \Z/2^{\ii}\Z$. \\ 
Let us suppose that the big code 
\[\calC_{\ii} := C_L(\calX_{\ii},\calP_{\ii},D_{\ii})\]
is construct such that 
\begin{itemize}
\item[-] The group $\calG_{\ii}$ acts freely on the support $\calP_{\ii}$, which is then made of distincts orbits of length 2. Later on, we will discuss its cardinality; 
\item[-] The divisor $D_{\ii} := r_{\ii}P_{\infty}^{(\ii)}$ is chosen as a multiple of $P_{\infty}^{(\ii)} \in \mathbb{P}_{F_{\ii}}$, which is then invariant under the action of $\calG_{\ii}$ since $P_{\infty}^{(\ii)}$ is totally ramified in the tower.
\end{itemize}

\s

\begin{rq1} \label{choice of P_inf} \rm
The authors in \cite{NOQ} describe a way to build a basis for the Riemann-Roch space associated to a multiple of the point at infinity, by using smaller Riemann-Roch spaces on the quotient curve at each step. This motivates our choice of divisor since we have a good way to construct basis of its Riemann-Roch space.
\end{rq1}

\s

In order to find a sequence of compatible divisors, one need a way to partitions the Riemann-Roch space of $D_{\ii}$. A decomposition as in Definition \ref{partitions of riemann spaces} is given by the following theorem 

\s

\begin{theorem} \label{decompositon}
Let $i \geq 1$ and $D_i \in \rm Div \it (F_i)$ that is invariant under the action of $\calG$. Then we have 
\[L_{\calX_i}(D_i) = \pi_{i-1}^*(L_{\calX_{i-1}}(E_{i,0})) \oplus  x_i \pi_{i-1}^*(L_{\calX_{i-1}}(E_{i,0})),\]
where $E_{i,j} := \left\lfloor \dfrac{1}{2} \pi_{i*}(D_i+j \cdot (\mu_i)^{F_i})\right\rfloor \in \rm Div \it (\calX_{i-1})$ for $j \in \{0,...,1\}$.
\end{theorem}

\s

\begin{proof}
This is Theorem 2.2 of \cite{MAH} applied to the Kummer extension $F_i/F_{i-1}$.
\end{proof}

\s

Note that this is exactly Kani's theorem in our situation, but since it may not applyied if char(\it $\mathbb{F}_{q^2})=2$ \rm . Thankfully, Maharaj's Theorem apply even in this situation in the context of Kummer extensions. \\
If we apply Theorem \ref{decompositon} to our choice of divisor, that is a multiple of the point at at infinity, we get

\s

\begin{corollary} \label{our decomposition}
Let $1 \leq i \leq \ii$ and consider the divisor $D_i := r_i P_{\infty}^{(i)}$. Then
\[ L_{\calX_i}(D_i) = \pi_{i-1}^*(L_{\calX_{i-1}}(E_{i,0})) \oplus  x_i \pi_{i-1}^*(L_{\calX_{i-1}}(E_{i,0})),\]
with 
\[E_{i,0} = \left \lfloor \frac{r_i}{2}\right\rfloor P_{\infty}^{(i-1)}\]
and 
\[E_{i,1} = 2^{i-2}D_{i-2}^{(i-1)} + \left \lfloor \frac{r_i-1}{2}\right\rfloor P_{\infty}^{(i-1)} - \sum\limits_{r=-2}^{\lfloor \frac{i-3}{2}\rfloor} D_r^{(i-1)} - \sum\limits_{r=\lfloor \frac{i-1}{2}\rfloor}^{i-3} 2^{2r-i+2}D_r^{(i-1)}\]
\end{corollary}

\s

\begin{proof}
Immediate consequence of Theorem \ref{decompositon}. Note that the structure of the divisor $E_{i,1}$ follows from the structure of the divisor $(x_i)^{F_i}$ (see Proposition \ref{div principaux} 1.) and the ramification of the divisors $D_r^{(i)}$ (see. Corollary \ref{deg et ram D_r}, 2.). 
\end{proof}

\s

\subsection{Construction of compatible divisors}

\s

Recall that in Definition \ref{compatible}, we have relaxed the properties for a divisor to be compatible, compared t the ones used in \cite{IOPP}. Let us explain now how to satistyies theses properties in the tower $\calF$, with our choice of one point divisor. \\
Starting from a divisor of the form $D_{\ii} := r_{\ii}P_{\infty}^{(\ii)}$, we aim to build a sequence of divisors $(D_i)$ such that each $D_i$ is also only supported by the point $P_{\infty}^{(i)}$, in order to be able to use the decomposition of Riemann-Roch spaces given by Corollary \ref{our decomposition} at each step. At the step $i$, a reasonable choice for $D_{i-1}$ would be to take $D_{i-1} = E_{i,0}$, as it has the desired form itself. However, in order to satisfy condition 2. of Definition \ref{compatible}, we will need both divisors $D_{i-1}-E_{i,j}$ ($j=0,1$) to have a high degree. This is motivated by the following result.

\s

\begin{proposition} \label{hugues' result}
Let $D = \sum\limits_{i=1}^s n_iP_i$ be a divisor on a given function field $F$, and $1 \leq r \leq s$. If $\rm deg \it (D) \geq 2g(F)-1+r$, then there exist a function $h \in F$ such that 
\[\forall \ 1 \leq i \leq r \ , \ \nu_{P_i}(h) = -n_i.\]
In paticular, if $r=s$, we have $(h)^F_{\infty} = D$.
\end{proposition}

\s

\begin{proof}
Set $D' := D - \sum\limits_{i=1}^r P_i = (n_1-1)P_1 + ... + (n_r-1)P_r + n_{r+1}P_{r+1} + ... + n_sP_s$. By hypothesis, one have 
\[\rm deg \it (D') = \rm deg \it (D) - r \geq 2g(F)-1.\]
Thus, for every $1 \leq i \leq r$, we have equality in Riemann-Roch Theorem, and 
\[\ell(D'+P_i) = \ell(D')+1.\] 
As a result, there exist functions $h_i \in L(D'+P_i)\backslash L(D')$ for $1 \leq i \leq r$, such that 
\[\nu_{P_i}(h_i) = -n_i\]
and for every $1 \leq j \leq r$ with $j \neq i$, 
\[\nu_{P_j}(h_i) \geq \nu_{P_j}(D'+P_i) = -n_j+1.\]
Set $h := \sum\limits_{i=1}^r h_i \in F$. Then the strict triangular inegality gives, pour any $1 \leq i \leq r$
\begin{align*}
\nu_{P_i}(h) &= min\{\nu_{P_i}(h_i),\nu_{P_i}(h-h_i)\} \\
	&= -n_i.
\end{align*}
The result follows.
\end{proof}

\s

From the above proposition and according to Definition \ref{compatible}, we need at each step that for $j=0,1$
\begin{equation} \label{only}
\rm deg \it \left(D_{i-1} - E_{i,j} + (f_{i-1,j})^{F_{i-1}}\right) \geq \rm 2 \it g(F_{i-1}) -1 + \#\rm Supp \it \left( D_{i-1} - E_{i,j} + (f_{i-1,j})^{F_{i-1}} \right).
\end{equation}

For this reason and in without changing the support of our divisors, on need to raise $\nu_{P_{\infty}^{(i-1)}}(D_{i-1})$. In what follows, we will choose a positive integer $\alpha_{i-1}$ such that $D_{i-1} := \left(\left \lfloor \frac{r_i}{2}\right\rfloor + \alpha_{i-1} \right) P_{\infty}^{(i-1)}$.

\s


\begin{lemma} \label{study diff}
Fix $0 \leq i \leq \ii$, and suppose that $D_i := r_i P_{\infty}^{(i)} \in \rm Div \it (F_i)$. Let us choose $D_{i-1} := \left(\left \lfloor \frac{r_i}{2}\right\rfloor + \alpha_{i-1} \right) P_{\infty}^{(i-1)}$ as above. Then
\[D_{i-1} - E_{i,0} = \alpha_{i-1} P_{\infty}^{(i-1)}\]
and 
\[D_{i-1} - E_{i,1} = \left( \left \lfloor \frac{r_i}{2}\right\rfloor - \left \lfloor \frac{r_i-1}{2}\right\rfloor + \alpha_{i-1} \right)  P_{\infty}^{(i-1)} - 2^{i-2}D_{i-2}^{(i-1)} + \sum\limits_{r=-2}^{\lfloor \frac{i-3}{2}\rfloor} D_r^{(i-1)} + \sum\limits_{r=\lfloor \frac{i-1}{2}\rfloor}^{i-3} 2^{2r-i+2}D_r^{(i-1)} \]
\end{lemma}

\s

\begin{proof}
Immediate consequence of Corollary \ref{our decomposition}.
\end{proof}

\s

\subsubsection{Towards an effecticive divisor}

\s

With the choice we made in Lemma \ref{study diff}, note we already have $D_{i-1}-E_{i,0} \geq 0$, that is we don't have to seek for a function $f_{i-1,0}$ (see Definition \ref{compatible}, 1.). However, it is clear from the same Lemma that the divisor $D_{i-1}-E_{i,1}$ is not effective. Our next goal will then be to find a function $f_{i-1,1} \in F_{i-1}$ such that 
\begin{equation} \label{recherche f_i}
D_{i-1} - E_{i,1} +(f_{i-1,j})^{F_{i-1}} \geq 0.
\end{equation}
In particular, since we want to apply this work to an effective IOPP, we would like to find an explicit form for the function $f_{i-1,1}$ (for every $0 \leq i \leq \ii$). We will see below that this is possible, and that we can even construct resursively the functions $(f_{i-1,1})_i$, allowing the prover to precompute it. 

\s

Looking at the expression of $D_{i-1}-E_{i,1}$, note that its pole divisor is $2^{i-2}D_{i-2}^{(i-1)}$. In order to correct this, one need to find a rationnal function those zero divisor is also supported by the divisor $D_{i-2}^{(i-1)}$.

\s

\todo{ case i=2 and i=3 for the choices of $f_2$ and $f_1$}

\begin{lemma} \label{f_i 1}
Let $i \geq 3$. Then we have 
\[\left(\dfrac{1+x_{i-1}^2}{1+x_{i-2}}\right)^{F_{i-1}} = 2^{i-2}D_{i-2}^{(i-1)} - 2^{i-4}D_{i-4}^{(i-1)}.\]
\end{lemma}

\s

\begin{proof}
Using Proposition \ref{div principaux}, we compute
\[\left(\dfrac{1+x_{i-1}^2}{1+x_{i-2}}\right)^{F_{i-1}}  = 2^{i-2}D_{i-2}^{(i-1)} + \left[(x_{i-2})^{F_{i-1}}_{\infty} - 2(x_{i-1})^{F_{i-1}}_{\infty}\right],\]
where 
\begin{align*} \null  (x_{i-2})^{F_{i-1}}_{\infty} - 2(x_{i-1})^{F_{i-1}}_{\infty}  = \pi^*\left(P_{\infty}^{(i-2)} + \sum\limits_{r=-2}^{\lfloor \frac{i-5}{2}\rfloor} D_r^{(i-2)} + \sum\limits_{r=\lfloor \frac{i-3}{2}\rfloor}^{i-5} 2^{2r-i+4}D_r^{(i-2)}\right) & \\ - 2 \left( P_{\infty}^{(i-1)} + \sum\limits_{r=-2}^{\lfloor \frac{i-4}{2}\rfloor} D_r^{(i-1)} + \sum\limits_{r=\lfloor \frac{i-2}{2}\rfloor}^{i-4} 2^{2r-i+3}D_r^{(i-1)}\right)
\end{align*}
From Corollary \ref{deg et ram D_r}, we know that any place in $D_r^{(i-2)}$ ramifies in $F_{i-1}/F_{i-2}$ if and only $i-1 \geq 2r+3$, ie. $\lfloor \frac{i-4}{2}\rfloor \geq r$. Thus, we get
\begin{align*}
(x_{i-2})^{F_{i-1}}_{\infty} - 2(x_{i-1})^{F_{i-1}}_{\infty} &= 
2\sum\limits_{r=-2}^{\lfloor \frac{i-5}{2}\rfloor} D_r^{(i-1)} + \sum\limits_{r=\lfloor \frac{i-3}{2}\rfloor}^{i-5} 2^{2r-i+4}D_r^{(i-1)} - 2\sum\limits_{r=-2}^{\lfloor \frac{i-4}{2}\rfloor} D_r^{(i-1)} + \sum\limits_{r=\lfloor \frac{i-2}{2}\rfloor}^{i-4} 2^{2r-i+4}D_r^{(i-1)} \\
&= \left\{ \begin{array}{ll}
-2^{2(i-4)-i+4}D_{i-4}^{(i-1)} = -2^{i-4}D_{i-4}^{(i-1)} \ , \ \rm if \ \it i \equiv \rm 1[2] \\
-2D_{\lfloor \frac{i-4}{2}\rfloor}^{(i-1)} + 2 \cd 2^{2\lfloor \frac{i-3}{2} \rfloor -i+4} D_{\lfloor \frac{i-3}{2} \rfloor}^{(i-1)} - 2^{i-4}D_{i-4}^{(i-1)} = 2^{i-4}D_{i-4}^{(i-1)} \ , \ \rm if \ \it i \equiv \rm 0[2]
\end{array}
\right. \\
&= -2^{i-4}D_{i-4}^{(i-1)}.
\end{align*}
The result follows.
\end{proof}

\s

The above Lemma provides a function in $F_{i-1}$ those exact zero divisor is the pole divisor of $D_{i-1}-E{i,1}$. Note however that we can not take $f_{i-1,1} = \dfrac{1+x_{i-1}^2}{1+x_{i-2}}$ since we will create another pole. To overcome this difficulty, we use the fact that we can raise the valuation at $P_{\infty}^{(i-1)}$ via the integer $\alpha_{i-1}$. The idea is thus to find a function $h_{i-1}$ in $F_{i-1}$ whose only pole is at $P_{\infty}^{(i-1)}$, and then to use it to correct the remaining pole. Note that this will forces us to choose $\alpha_{i-1} \geq \rm deg \it ((h_{i-1})^{F_{i-1}}_0))$.

\s

\begin{proposition} \label{function h}
Let $i \geq 3$, and set $h_{i-1} := \prod\limits_{j=0}^{i-1}x_j \in F_{i-1}$. Then we have 
\[(h_{i-1})^{F_{i-1}} = \sum\limits_{r=-2}^{\lfloor \frac{i-3}{2}\rfloor} D_r^{(i-1)} + \sum\limits_{r=\lfloor \frac{i-1}{2}\rfloor}^{i-3} 2^{2r-i+3}D_r^{(i-1)} - (2^{i}-1) P_{\infty}^{(i-1)}.\]

\end{proposition}

\s

\begin{proof}
We proceed by induction en the integer $i \geq 3$. For $i=3$, we have $h_2 = x_0x_1x_2$, thus using Proposition \ref{div principaux}, item 1., we get
\begin{align*}
(h_2)^{F_2} &= (x_0)^{F_2} + (x_1)^{F_2} + (x_2)^{F_2} \\
&= (4D_{-2}^{(2)}-4P_{\infty}^{(2)}) + (2D_{-1}^{(2)}-2D_{-2}^{(2)} - 2P_{\infty}^{(2)}) + (D_0^{(2)} - D_{-2}^{(2)} - D_{-1}^{(2)} - P_{\infty}^{(2)}) \\
&= D_{-2}^{(2)} + D_{-1}^{(2)} + D_{0}^{(2)} - 7P_{\infty}^{(2)},
\end{align*}
which gives the initialisation. Now, let us suppose the formula true for a given $i \geq 3$. Taking the pullback, and recalling that any place in $D_r^{(i-1)}$ ramifies in $F_i/F_{i-1}$ if and only if $\lfloor \frac{i-3}{2} \rfloor \geq r$ (see 2., Corollary \ref{deg et ram D_r}), we have
\[(h_{i-1})^{F_i} = 2\sum\limits_{r=-2}^{\lfloor \frac{i-3}{2}\rfloor} D_r^{(i)} + \sum\limits_{r=\lfloor \frac{i-1}{2}\rfloor}^{i-3} 2^{2r-i+3}D_r^{(i)} - (2^{i+1}-2) P_{\infty}^{(i)}.\]
From Proposition \ref{div principaux}, item 1., we get
\begin{align*}
(h_i)^{F_i} &= (h_{i-1})^{F_i} + (x_i)^{F_i} \\
&= \sum\limits_{r=-2}^{\lfloor \frac{i-3}{2}\rfloor} D_r^{(i)} + \sum\limits_{r=\lfloor \frac{i-1}{2}\rfloor}^{i-3} (2^{2r-i+3}-2^{2r_i+2})D_r^{(i)} + 2^{i-2}D_{i-2}^{(i)} + (2^{i}-2+1) P_{\infty}^{(i)} \\
&= \sum\limits_{r=-2}^{\lfloor \frac{i-2}{2}\rfloor} D_r^{(i)} +
 \sum\limits_{r=\lfloor \frac{i}{2}\rfloor}^{i-2} 2^{2r-i+2}D_r^{(i)} - (2^{i+1}-1) P_{\infty}^{(i)},
\end{align*}
which gives the result. Note that in the last equality, we need to take care of the values of $\lfloor \frac{i-1}{2} \rfloor$,  $\lfloor \frac{i}{2} \rfloor$ and $\lfloor \frac{i+1}{2} \rfloor$ when we change the indices in our sums. The lector can easyly verify that the equality holds, by checking according to the parity of $i$.
\end{proof}

\s

The function $h_{i-1}$ introduced in the above proposition looks promising since it has the same zeroes as the divisor $D_{i-1}-E_{i,1}$ (see Lemma \ref{study diff}), exepted for the point at infinity whose huge pole can be controlled using the integer $\alpha_i$. Our final choice of function $f_{i-1,1}$ is given below.

\s

\begin{corollary} \label{choice of f_i}
Let $i \geq 3$. Set $f_{i-1,1} := h_{i-1}^2\dfrac{1+x_{i-1}^2}{1+x_{i-2}} \in F_{i-1}$. Then 
\[(f_{i-1,1})^{F_{i-1}} = 2^{i-2}D_{i-2}^{(i-1)} + 2\sum\limits_{r=-2, r \neq i-4}^{\lfloor \frac{i-3}{2}\rfloor} D_r^{(i-1)} + \sum\limits_{r=\lfloor \frac{i-1}{2}\rfloor, r \neq i-4}^{i-3} 2^{2r-i+4}D_r^{(i-1)} - (2^{i+1}-2) P_{\infty}^{(i-1)}.\]
\end{corollary}

\s

\begin{proof}
Consequence of  Lemma \ref{f_i 1} and Proposition \ref{function h}.
\end{proof}

\s

\begin{rq1} \rm
Note that we had to take $h_{i-1}^2$ instead of $h_{i-1}$ in the construction of $f_{i-1,1}$, since otherwise we would still have a pôle at $D_{i-4}^{(i-1)}$. Taking a square a the optimial choice to balance the remaining pole.
\end{rq1}

\s

\begin{corollary} \label{our effective divisor}
Let $i \geq 3$. Then 
\begin{align*}
G_{i-1} := D_{i-1} -E_{i,1} + (f_{i-1,1})^{F_{i-1}} &= \left( \left \lfloor \frac{r_i}{2}\right\rfloor - \left \lfloor \frac{r_i-1}{2}\right\rfloor + \alpha_{i-1} +2-2^{i+1}\right)  P_{\infty}^{(i-1)} + 3\sum\limits_{r=-2,r\neq i-4}^{\lfloor \frac{i-3}{2}\rfloor} D_r^{(i-1)} + \\ & +3 \sum\limits_{r=\lfloor \frac{i-1}{2}\rfloor,r\neq i-4}^{i-3} 2^{2r-i+2}D_r^{(i-1)} + \left\{ \begin{array}{ll}
2^{i-6}D_{i-4}^{(i-1)} \ , \ i \geq 6 \\
D_{i-4}^{(i-1)} \ , \ i \leq 5.
\end{array}
\right.
\end{align*}
Moreover, if $\alpha_{i-1} \geq 2^{i+1}$, then $G_{i-1}$ is an effective divisor.
\end{corollary}

\s

\begin{proof}
The result follows from Lemma \ref{study diff} and Corollary \ref{choice of f_i}. Moreover, it is clear that $G_{i-1}$ is effective if and only if its valuation at $P_{\infty}^{(i-1)}$ is non négative, that is
\[\left \lfloor \frac{r_i}{2}\right\rfloor - \left \lfloor \frac{r_i-1}{2}\right\rfloor + \alpha_{i-1} +2-2^{i+1} > 0.\]
Thus, taking $\alpha_{i-1} \geq 2^{i+1}$ is a sufficient condition.
\end{proof}

\s

At this step, starting from a divisor $D_i = r_iP_{\infty}^{(i)} \in \rm Div \it (F_i)$, we have constructed a divisor $D_{i-1}$ supported by $P_{\infty}^{(i-1)}$, as well as functions $f_{i-1,j} \in F_{i-1}$ (for $j=0,1$) such that the condition 1. of Definition \ref{compatible} is satisfyed. It then remains to find balancing functions $\nu_{i-1,j} \in F_{i-1}$ that satisfy condiotion 2. of divisor compatibility.

\s

\subsubsection{Searching for balancing functions}

\s

In this section, we will discuss whenever there exist balancing functions in our settings. The idea here is again to take $\alpha_{i-1}$ big enough such that we can use Proposition \ref{hugues' result} to ensure we can find balancing functions. With previous notations, a sufficient condition is given by (see. Equation (\ref{only}))
\begin{equation} \label{9}
\rm deg \it (D_{i-1}) = \alpha_{i-1} \geq \rm 2 \it g \it (F_{i-1}). 
\end{equation}
for the choice of $\nu_{i-1,0}$ and 
\begin{equation} \label{condition pour balancer}
\rm deg \it \left(G_{i-1}\right) \geq \rm 2 \it g(F_{i-1}) -1 + \#\rm Supp \it \left( G_{i-1} \right)
\end{equation}
for $\nu_{i-1,1}$.
Keep in mind that we already supposed above that $\alpha_{i-1} \geq 2^{i+1}$. Here, we are led to study the degree and the cardinality of the support of $G_{i-1}$.

\s

\begin{lemma} \label{deg Gi}
Let $i \geq 3$. Then 
\begin{equation*}
\rm{deg} (\it G_{i-1}) =  \rm \left \lfloor \frac{r_i}{2}\right\rfloor - \left \lfloor \frac{r_i-1}{2}\right\rfloor + \alpha_{i-1}-2^{i} -1 + 3 \cd 2^{\lfloor \frac{i+1}{2} \rfloor} + \left\{ \begin{array}{ll}
 0 \ , \ \rm{if} \ \it i \leq 5 \\
 2^{i-2} \ , \ \rm{if} \ \it i \geq 6.
\end{array}
\right.
\end{equation*}
\end{lemma}

\s

\begin{proof}
Recall the structure of the divisor $G8{i-1}$ from Corollary \ref{our effective divisor}. In order to compute its degree, we need to care for the special value $r=i-4$ (depending on if $D_{i-4}^{(i-1)}$ is in the first or the second sum. Recall the formula for the degree of $D_r^{(i-1)}$ (see Corollary \ref{deg et ram D_r}). In particular, we have 
\begin{equation*}
\rm{deg} (\it D_{i- \rm 4}^{(i-1)}) = \left\{ \begin{array}{ll}
8 \ , \ \rm{if} \ i \geq 6 \\
2^{i-2} \ , \ \rm{if} \ i \leq 5.
\end{array}
\right.
\end{equation*}
Moreover, if $i \leq 5$, then the divisor $D_{i-4}^{(i-1)}$ is in the first sum, that is we have in this case
\begin{align*}
\rm{deg}(\it G_{i-1}) &= \left( \left \lfloor \frac{r_i}{2}\right\rfloor - \left \lfloor \frac{r_i-1}{2}\right\rfloor + \alpha_{i-1} +2-2^{i+1}\right) + 3\sum\limits_{r=-2}^{\lfloor \frac{i-3}{2}\rfloor} 2^{r+2} +3 \sum\limits_{r=\lfloor \frac{i-1}{2}\rfloor}^{i-3} 2^{2r-i+2}2^{i-1-r} - \underbrace{2\cd 2^{i-2}}_{r=i-4} \\
&= \left( \left \lfloor \frac{r_i}{2}\right\rfloor - \left \lfloor \frac{r_i-1}{2}\right\rfloor + \alpha_{i-1} +2-2^{i+1}\right) + 3 \cd 4\sum\limits_{r=-2}^{\lfloor \frac{i-3}{2}\rfloor} 2^{r} + 3 \cd 2 \sum\limits_{r=\lfloor \frac{i-1}{2}\rfloor}^{i-3} 2^r - 2^{i-1} \\
&= \left( \left \lfloor \frac{r_i}{2}\right\rfloor - \left \lfloor \frac{r_i-1}{2}\right\rfloor + \alpha_{i-1} +2-2^{i+1}\right) + 3 \left( 2^{\lfloor \frac{i+3}{2} \rfloor}-1 + 2^{i-1} - 2^{\lfloor \frac{i+1}{2}\rfloor} \right) - 2^{i-1} \\
&= \left \lfloor \frac{r_i}{2}\right\rfloor - \left \lfloor \frac{r_i-1}{2}\right\rfloor + \alpha_{i-1} -1-2^{i+1} + 3 \cd 2^{\lfloor \frac{i+1}{2}\rfloor} + 3^cd 2^{i-1}-2^{i-1} \\
&=\left \lfloor \frac{r_i}{2}\right\rfloor - \left \lfloor \frac{r_i-1}{2}\right\rfloor + \alpha_{i-1} -1-2^{i+1} + 3 \cd 2^{\lfloor \frac{i+1}{2}\rfloor} + 2^i \\
&=\left \lfloor \frac{r_i}{2}\right\rfloor - \left \lfloor \frac{r_i-1}{2}\right\rfloor + \alpha_{i-1} -1-2^{i} + 3 \cd 2^{\lfloor \frac{i+1}{2}\rfloor}
\end{align*}
Now if $i \geq 6$, the divisor $D_{i-4}^{(i-1)}$ is in the second sum and as a fixed degree of $8$. Thus we have 
\begin{align*}
\rm{deg}(\it G_{i-1}) &= \left( \left \lfloor \frac{r_i}{2}\right\rfloor - \left \lfloor \frac{r_i-1}{2}\right\rfloor + \alpha_{i-1} +2-2^{i+1}\right) + 3\sum\limits_{r=-2}^{\lfloor \frac{i-3}{2}\rfloor} 2^{r+2} +3 \sum\limits_{r=\lfloor \frac{i-1}{2}\rfloor}^{i-3} 2^{r+1} + \underbrace{(-3\cd 2^{i-3} + 2^{i-6}\cd 8)}_{r=i-4} \\
&= \left( \left \lfloor \frac{r_i}{2}\right\rfloor - \left \lfloor \frac{r_i-1}{2}\right\rfloor + \alpha_{i-1} +2-2^{i+1}\right) + 3 \cd 4\sum\limits_{r=-2}^{\lfloor \frac{i-3}{2}\rfloor} 2^{r} + 3 \cd 2 \sum\limits_{r=\lfloor \frac{i-1}{2}\rfloor}^{i-3} 2^r - 2^{i-2} \\
&= \left( \left \lfloor \frac{r_i}{2}\right\rfloor - \left \lfloor \frac{r_i-1}{2}\right\rfloor + \alpha_{i-1} +2-2^{i+1}\right) + 3 \left( 2^{\lfloor \frac{i+3}{2} \rfloor}-1 + 2^{i-1} - 2^{\lfloor \frac{i+1}{2}\rfloor} \right) - 2^{i-2} \\
&= \left \lfloor \frac{r_i}{2}\right\rfloor - \left \lfloor \frac{r_i-1}{2}\right\rfloor + \alpha_{i-1} -1-2^{i+1} + 3 \cd 2^{\lfloor \frac{i+1}{2}\rfloor} + 5 \cd 2^{i-2} \\
&=\left \lfloor \frac{r_i}{2}\right\rfloor - \left \lfloor \frac{r_i-1}{2}\right\rfloor + \alpha_{i-1} -1-2^{i+1} + 3 \cd 2^{\lfloor \frac{i+1}{2}\rfloor} + 2^i + 2^{i-2} \\
&=\left \lfloor \frac{r_i}{2}\right\rfloor - \left \lfloor \frac{r_i-1}{2}\right\rfloor + \alpha_{i-1} -1-2^{i} + 3 \cd 2^{\lfloor \frac{i+1}{2}\rfloor} + 2^{i-2}.
\end{align*}
\end{proof}

\s

\begin{lemma} \label{supp Gi}
Let $i \geq 3$. Then 
\[ \#\rm{Supp} (\it{G}_{i- \rm 1}) = \rm 3 \cd 2^{\lfloor \frac{i+3}{2}\rfloor} - 4. \]
\end{lemma} 

\s

\begin{proof}
Note that every place in the support of some $D_r^{(i-1)}$ has degree one, then we have from Corollary \ref{deg et ram D_r}
\begin{align*}
\#\rm{Supp} (\it{G}_{i- \rm 1}) & = 1 + \sum\limits_{r=-2}^{\lfloor \frac{i-3}{2}\rfloor} \#\rm{Supp} (\it{D_r^{(i-1)}})  + \sum\limits_{r=\lfloor \frac{i-1}{2}\rfloor}^{i-3} \#\rm{Supp} (\it{D_r^{(i-1)}}) \\
& = 1 + \sum\limits_{r=-2}^{\lfloor \frac{i-3}{2}\rfloor} 2^{r+2}  + \sum\limits_{r=\lfloor \frac{i-1}{2}\rfloor}^{i-3} 2^{i-1-r} \\
&= 1 + 4(2^{\lfloor \frac{i-1}{2}\rfloor}-1/4) + 2^i(2^{-\lfloor \frac{i-1}{2} \rfloor}- 2^{2-i}) \\
&= 2^{\lfloor \frac{i+3}{2}\rfloor} + 2^{\lfloor \frac{i+1}{2}\rfloor}-4 \\
&= 3 \cd 2^{\lfloor \frac{i+3}{2}\rfloor} - 4.
\end{align*}
\end{proof}

\s

As a consequence, the conditions $(\ref{9})$ and (\ref{condition pour balancer}), combined with the fact that we already have $\alpha_{i-1} \geq 2^{i+1}$ leads to the following condition on $\alpha_{i-1}$.

\s

\begin{corollary} \label{conditions on alpha_i}
Let $i \geq 3$. Then if 
\begin{equation} \label{final condition on alpha}
\alpha_{i-1} \geq 3\cd 2^i-2 \ ,
\end{equation}
 there exist balancing function $\nu_{i-1,j} \in F_{i-1}$ that satisfy \rm{2.} \it in Definition \ref{compatible}.
\end{corollary}

\s

\begin{proof}
Note that the hypothesis $\alpha_{i-1} \geq 2^{i+1}$ already implies $(\ref{9})$. Let us check the condition (\ref{condition pour balancer}) in details. We have using Corollary \ref{genus}, Lemma \ref{deg Gi} and  Lemma \ref{supp Gi}
\begin{align*}
 & \quad \quad  \rm deg \it \left(G_{i-1}\right)  \geq \rm 2 \it g(F_{i-1}) -1 + \#\rm Supp \it \left( G_{i-1} \right) \\
& \iff \alpha_{i-1} \geq 2g(F_{i-1}) -1 + 3 \cd 2^{\lfloor \frac{i+3}{2}\rfloor} - 4 - \left \lfloor \frac{r_i}{2}\right\rfloor + \left \lfloor \frac{r_i-1}{2}\right\rfloor +2^i +1 - 3\cd2^{\lfloor \frac{i+1}{2}\rfloor} - \left\{ \begin{array}{ll}
0 \ , \ i \leq 5 \\
2^{i-2} \ , \ i \geq 6
\end{array}
\right. \\
&  \quad \quad \geq 2g(F_{i-1}) + 3 \cd 2^{\lfloor \frac{i+1}{2}\rfloor} - 4 + \left\{ \begin{array}{ll}
2^i \ , \ i \leq 5 \\
3 \cd 2^{i-2} \ , \ i \geq 6
\end{array}
\right. \\
&  \quad \quad \geq \left\{ \begin{array}{ll}
2^{i+1}-3\cd 2^{\frac{i+1}{2}} +2 + 3 \cd 2^{\lfloor \frac{i+1}{2}\rfloor} - 4 +2^i \ , \ i\equiv 1[2]\\
2^{i+1}- 2^{\frac{i+4}{2}} +2 + 3 \cd 2^{\lfloor \frac{i+1}{2}\rfloor} - 4 +2^i \ , \ i\equiv 0[2]
\end{array}
\right. \\
& \quad \quad \geq \left\{ \begin{array}{ll}
2^{i+1}-2 +2^i \ , \ i\equiv 1[2]\\
2^{i+1}- 2-2^{\frac{i}{2}} + 2^i \ , \ i\equiv 0[2]
\end{array}
\right. \\
& \quad \quad  \geq 3 \cd 2^i-2 \ , \ \forall \ i,
\end{align*}
which gives the desired condition.
\end{proof}



























\newpage
\bibliographystyle{alpha}
\bibliography{biblio_ag_ioppp_towers}




























\end{document}