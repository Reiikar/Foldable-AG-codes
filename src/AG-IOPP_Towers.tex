\documentclass[10pt]{article}

\input{header.tex}


\title{Families of codes from tower of curves which are compatible with proximity testing}

\author{Sarah Bordage, Mathieu Lhotel, Jade Nardi, Hugues Randriam}

\begin{document}

\maketitle

\section{Introduction}

Étant donnée une tour de corps de fonctions $(F_i)_{i \geq 0}$, notre objectif sera de construire une suite de codes géométriques $(\mathcal{C}_i)$ sur $F_i$ ($i \geq 0$); de tel sorte que l'on puisse réduire un test de proximité au "gros" code $C_i$ à un test de proximité sur ses replies successifs (ie. les codes $\mathcal{C}_j$ construit sur les $F_j$, pour $j \leq i$. \\
Pour cela, on considérera différentes tours de corps de fonctions, qui vérifient de "bonnes propriétés", du type :
\begin{enumerate}
\item On est capable de décomposer un espace de Riemann-Roch sur $F_i$ avec des espaces de Riemann-Roc sur les courbes quotients définies par les $F_j$, $j \leq i$;
\item On est en mesure de calculer de manière efficace les espaces de Riemann-Roch dans la tour;
\item On connaît la ramification dans la tour $(F_i)$, ainsi qu'une formule du genre $g_i = g(F_i)$ pour tout $i$;
\item Les corps de fonctions successifs $F_i$ possèdent "beaucoup" de points rationnels, ce qui nous permet de construire des codes géométriques assez longs.
\end{enumerate}

\subsection{Foldables codes from tower of curves}

\todo{Rappeler les cdts pour les codes foldables. Un beau copier-coller dessous !}



\subsubsection{Sequence of curves}
Fix a curve $\mathcal{C}$ defined over $\F$ and a finite solvable group $\calG \subseteq \Aut(\mathcal{C})$ whose order is coprime with the characteristic of $\F$. The hypothesis of solvability yields a sequence of subgroups of $\calG$
\begin{equation}\label{diag:seq_groups}
	\calG=\calG_0 \vartriangleright \calG_1 \vartriangleright \dots \vartriangleright \calG_r = 1,  
\end{equation}
such that $\calG_{i+1}$ is a normal subgroup of $\calG_i$ and the factor group $\Gamma_i := \calG_i /\calG_{i+1} \simeq \Z/p_i \Z$ is a cyclic group of prime order $p_i$. A sequence like \eqref{diag:seq_groups} is not unique but another sequence of this type would have the same length and the same set of factor groups, up to permutation, by Jordan–Hölder theorem.

The group $\Gamma_0$ acts on $\calC_0\mydef \calC$, as a quotient of $\calG$. We thus define the quotient curve $\calC_1 \mydef \calC_0 / \Gamma_0$. The group $\Gamma_1$ is constant on the orbits under $\Gamma_0$. Repeating the process for every $i \in \range{r}$ defines a sequence of curves recursively  as follows:
\[\mathcal{C}_0:=\mathcal{C} \text{ and } \mathcal{C}_{i+1}=\mathcal{C}_i/\Gamma_i.\]
We denote by $\pi_i: \mathcal{C}_i \rightarrow \mathcal{C}_{i+1}$ the canonical projection modulo the action of $\Gamma_i$.
\begin{equation}\label{diag:seq_curves}
	\begin{tikzcd}
		\mathcal{C}_0\arrow[loop, distance=14, out=130, in=100,"\Gamma_0"] \arrow[r, two heads, "\pi_0"] & \mathcal{C}_1\arrow[loop, distance=14, out=130, in=100,"\Gamma_1"] \arrow[r, two heads, "\pi_1"] & \dots  \arrow[r, two heads, "\pi_i"] & \mathcal{C}_i\arrow[loop, distance=14, out=130, in=100,"\Gamma_i"] \arrow[r, two heads, "\pi_{i+1}"]& \mathcal{C}_{i+1}\arrow[loop, distance=14, out=130, in=100,"\Gamma_{i+1}"] \arrow[r, two heads] & \dots \arrow[r, two heads,"\pi_{r-1}"] & \mathcal{C}_{r}
	\end{tikzcd}
\end{equation}

\jade{On pourrait peut-être en choisir une unique en faisant croître ou décroître les $p_i$.}
\begin{definition}
	A sequence of curve constructed as above will be called a \emph{$(\calC,\calG)$-sequence}.
\end{definition}

\subsubsection{Sequence of codes}\label{subsubsec:def-codes}

We aim to construct a sequence of codes from a $(\calC,\calG)$-sequence of curves, which is compatible with the action at each step.

First, fix an effective divisor $D_0 \in \Div(\mathcal{C}_0)$ supported by $\Gamma_0$-invariant points.

For any $i \in \range{r}$, the factor group $\Gamma_i$ is cyclic of order $p_i$. Write $\zeta_i$ for a primitive $p_i^{th}$ root and $\Gamma_i=\gen{\gamma_i}$.

\paragraph{Divisors.}
To make our protocol complete and sound, we need to choose at each step a divisor which is compatible with the previous one in the sense of the following definition.

\begin{definition}\label{def-div_compatible}
	Let $D_i \in \Div(\calC_i)$ and $\mu_i \in \F(\calC_i)$ such that 
	\begin{equation}\label{eq:def-mu_i}
		\gamma_i \cdot \mu_i = \zeta_i \mu_i.
	\end{equation} For any $j \in \range{p_i}$, we define the divisor 
	\[	E_{i,j}\mydef \Floor{\frac{1}{p_i}{\pi_i}_*( D_i + j(\mu_i))} \in \Div(\mathcal{C}_{i+1}).\]
	
	A divisor $D_{i+1} \in \Div(\calC_{i+1})$ is said to be \emph{compatible with $(D_i,\mu_i)$} if all the following assertions hold.
	\begin{enumerate}
		\item $D_{i+1}$ is supported by $\Gamma_{i+1}$-invariant points, 
		\item for every $j \in \range{p_i}$, $E_{i,j} \leq D_{i+1}$,
		\item  for every $j \in \range{p_i}$, there exists a function $\nu_{i+i,j}\in \F(\calC_{i+1})$ such that $\poles{\nu_{i+i,j}}=D_{i+1} - E_{i,j}$.	
	\end{enumerate}
\end{definition}

Among the three requirements for a divisor to be compatible with one of the previous curve, the third is definitely the most compelling. \jade{A détailler.} However, this item happens to be the main ingredient in Lemma \ref{lem:why_nuij}, which takes a prominent role in the choice of the folding operators.


\begin{lemma}\label{lem:why_nuij}
	Let $i \in \range{r}$, $D_i \in \Div(\calC_i)$ and $\mu_i \in \F(\calC_i)$ satisfying Eq. \eqref{eq:def-mu_i}. Consider a divisor $D_{i+1}\in\Div(\calC_{i+1})$ that is compatible with $(D_i,\mu_i)$.
	
	Fix $j \in \range{p_i}$. Then a function $g\in \F(\calC_{i+1})$ belongs to $L(E_{i,j})$ if and only if both functions $g$ and $g \nu_{i+1,j}$ belong to $L(D_{i+1})$.
\end{lemma}

\begin{proof} Assume that $g \in L(E_{i,j})$. Then the second and third items of Def. \ref{def-div_compatible} ensures that $g$ and $g\nu_{i+1,j}$ lie in $L(D_{i+1})$.
	
	Conversely, assume that $g$ and $g\nu_{i+1,j}$ belong to  $L(D_{i+1})$ and write $D_{i+1} = \sum n_P P$. The hypotheses on $g$ imply that {$g \in L(D_{i+1}) \cap L(D_{i+1} - (\nu_{i+1,j}))$}. By Lemma 2.6 \cite{MP93}, the function $g$ belongs to $L(D'_{i+1})$, where to divisor $D'_i$ is defined by
	\[D'_{i+1} \mydef \sum_P n'_P P \text{ where } n'_P \mydef \min(n_P,n_P+v_P(\nu_{i+1,j})).\]
	Then $D'_{i+1} = D_{i+1} - \poles{\nu_{i+1,j}} = E_{i,j}$ by the third item of Def. \ref{def-div_compatible}.
\end{proof}

\begin{definition}\label{def-mu_i_compatible}
	Let $(\calC_i)$ be a $(\calC,\calG)$-sequence. For every $i \in \range{r}$, take $\mu_i$ satisfying Eq. \eqref{eq:def-mu_i}. A sequence of divisor $(D_i) \in \Div(\calC_i)$ is said to be \emph{$(\mu_i)$-compatible} if for every $i \in \range{r}$, the divisor $D_{i+1}$ is $(D_i,\mu_i)$-compatible.
\end{definition}


\begin{definition}\label{def-div_compatible}
	Let $D_i \in \Div(\calX_i)$ and $\mu_i \in \F(\calX_i)$ such that 
	\begin{equation}\label{eq:def-mu_i}
		\gamma_i \cdot \mu_i = \zeta_i \mu_i.
	\end{equation} For any $j \in \range{p_i}$, we define the divisor 
	\begin{equation}\label{eq:def-Eij}
		E_{i,j}\mydef \Floor{\frac{1}{p_i}{\pi_i}_*( D_i + j(\mu_i))} \in \Div(\mathcal{C}_{i+1}).
	\end{equation}
	
	A divisor $D_{i+1} \in \Div(\calX_{i+1})$ is said to be \emph{compatible with $(D_i,\mu_i)$} if all the following assertions hold.
	\begin{enumerate}
		\item $D_{i+1}$ is supported by $\Gamma_{i+1}$-fixed points, 
		\item for every $j \in \range{p_i}$, $E_{i,j} \leq D_{i+1}$,
		\item  for every $j \in \range{p_i}$, there exists a function $\nu_{i+i,j}\in \F(\calX_{i+1})$ such that
		\begin{equation}\label{eq:def-nu_i,j}
			\poles{\nu_{i+i,j}}=D_{i+1} - E_{i,j}.	
		\end{equation}
	\end{enumerate}
\end{definition}


The divisors $E_{i,j}$ in \eqref{eq:def-Eij} coincide with those in Theorem \ref{th:kani} and thus satisfy
\begin{equation}\label{eq:decomposition}
	L_{\calX_i}(D_i)= \bigoplus_{j=0}^{p_i-1} \mu_i^j \pi_i^* L_{\calX_{i+1}}(E_{i,j}).
\end{equation}
The first requirement ensures that the support of $D_{i+1}$ does not intersect with the set of evaluation points $\calP_{i+1}$. The second one implies that $L(E_{i,j}) \subseteq L(D_{i+1})$. The last condition means that for every $f_j \in L(E_{i,j})$, the function $\nu_{i+1, j}f_j$ lies in $L(D_{i+1})$.

Among those three requirements, the third is definitely the most compelling and requires some geometric knowledge about the curves $C_i$. Indeed, on a general curve, not every effective divisor is the poles locus of a function and characterizing which effective divisors arise this way is at the heart of the Weierstrass gaps theory. Nonetheless, the existence of the balancing functions $\nu_{i+1,j}$ happens to be the main ingredient in Lemma \ref{lem:why_nuij}, which takes a prominent role in the construction of the folding operators.

\begin{definition}[$(\mu_i)$-compatibility]\label{def-mu_i_compatible}
	Let $(\calX_i)$ be a $(\calX,\calG)$-sequence. For every $i \in \range{r}$, take $\mu_i \in \F(\calX_i)$ satisfying \eqref{eq:def-mu_i}. A sequence of divisor $(D_i) \in \Div(\calX_i)$ is said to be \emph{$(\mu_i)$-compatible} if for every $i \in \range{r}$, the divisor $D_{i+1}$ is $(D_i,\mu_i)$-compatible.
\end{definition}

\jade{Cette hypothèse a été relaxée :}
We have now described all the key components to formally define the notion of foldable codes. However, to ensure a good soundness of the protocol, we add a constraint on each divisor $D_{i+1}$ regarding $D_i$. Indeed, as illustrated by Example \ref{ex:bad_kummer}, even though there exists a $(D_i,\mu_i)$-compatible divisor $D_{i+1}$, its degree may be unexpectedly substantial, which would likely deteriorate the relative minimum distance of $C_{i+1}$. We thus demand $D_{i+1}$ to be equal to one of the divisors $E_{i,j}$ \eqref{eq:def-Eij} that appear in the decomposition \eqref{eq:decomposition} of $L_{\calX_i}(D)$.

\jade{Est-ce qu'on peut mettre les tours dans le cadre de cette définition?}

\begin{definition}[Foldable AG codes]\label{def:good_properties}
	Let $C =C(\calX,\calP,D)$ be an AG-code. This code is said to be \emph{foldable} if the following conditions are satisfied.
	\begin{itemize}
		\item There exists a finite solvable group $\calG \in \Aut(\calX)$ that acts freely on $\calP$ : a composition series of $\calG$ $\eqref{diag:seq_groups}$ provides a $(\calX,\calG)$-sequence of curves $(\calX_i)$;
		\item There exists $e \in (0,1)$ such that $\size{\calG} > \size{\calP}^e$;
		\item There exist a sequence $(\mu_i) \in \F(\calX_i)$ satisfying \eqref{eq:def-mu_i} and a sequence $(D_i) \in \Div(\calX_i)$ that is $(\mu_i)$-compatible such that for every $i \in \range{r}$,
		\begin{equation}\label{eq:cdt_Di+1}
			\exists \: j \in \range{p_i} \text{ such that } D_{i+1}=E_{i,j},
		\end{equation}
		where the divisors $E_{i, j}$ are defined as per Definition \ref{def-div_compatible}.
		
	\end{itemize}
	%Moreover, we say that $C$ is \emph{efficiently foldable} if $\size{\calG}$ is a smooth integer and the functions $\nu_{i+1, j} \in \F(\calX_{i+1})$ can be evaluated at a point $P \in \calP_{i+1}$ using a number of arithmetic operations which is independent of $\size{\calP}$.
\end{definition}

\subsection{Relaxing foldability conditions}



\section{Hermitian tower}

\subsection{Preliminaries}

We consider the sequence of function fields $\calF=(F_i)_{i\geq 0}$ over $\F_{q^2}$ that is defined recursively by $F_0=\F_{q^2}(x_0)$ and $F_i = F_{i-1}(x_i)$ with equations
\[x_i^q+x_{i} = x_{i-1}^{q+1} \text{ for } i\geq 1.\]
Note that this tower of function field $\mathcal{F}$ corresponds to a tower of curve
$(\calX_i)_{i\geq 0}$, where any $F_i$ is the function field of the curve $\calX_i$ over $\F_{q^2}$, that is with usual notations $F_i := \F_{q^2}(\calX_i)$. 
For $i=1$, the field $F_1$ is nothing but the function field of the well-known Hermitian curve $\mathcal{H}:= \cal{X}_1$ over $\F_{q^2}$.

The tower $\cal{F}$ is a tower of Artin-Schreier extensions, which have been extensively studied (see for example \cite{S08}). 

In what follows, let us denote by $P_{\infty}^{(0)}$ the unique pole of the function $x_0$ in $F_0$.

\begin{lemma}\cite[Proposition 3.7.8]{S08}
	Let $i \geq 1$. The place $P_{\infty}^{(0)}$ est totally ramified in $F_i$, and its unique extension, denoted by $P_{\infty}^{(i)}$, satisfies
\[e\left(P_{\infty}^{(i)}|P_{\infty}^{(0)}\right) = [F_i:F_0]=q^i.\]
\end{lemma}


The properties of the tower $\calF$ yields from those of the basic function field $F=\F_{q^2}(x,y)$, where $y^q+y=x^{q+1}$. Let us denote by $P^{(0)}$ the unique zero of the function $x$ on $\F_{q^2}$, so that
\[(x)^{\F_{q^2}} = P^{(0)} - P^{(0)}_{\infty}.\]
Then
\[(y)^H = (q+1)P^{(1)} - (q+1)P^{(1)}_{\infty};\]
where $P^{(1)}$ is the unique extension of $P^{(0)}$. Moreover, $P^{(1)}$ is the unique common zero of $x$ and $y$ in $F$.

By iteratively using these divisor decompositions, we get formula for the principal divisors $(x_i)^{F_i}$ at each step.
\begin{lemma} \label{div princ}
\begin{enumerate}
\item $P_{\infty}^{(0)}$ is the unique place that is ramified in the tower $\calF$;
\item For $i \geq 1$, we have 
\[(x_i)^{F_i} = (q+1)^i \left(P^{(i)} - P_{\infty}^{(i)}\right),\]
where $P^{(i)}$ is the unique common zero of the functions $x_0,...,x_i$;
\item For $i \geq 1$, we have 
\[(x_{i-1})^{F_i} = (q+1)^{i-1}S^{(i)} - q(q+1)^{i-1}P_{\infty}^{(i)},\]
%where $S^{(i)} = \sum\limits_{j=1}^q P_j^{(i)}$, avec $P_j^{(i)} \mid P^{(i-1)}$.
where $ S^{(i)} = \sum_{Q\mid P^{(i-1)}} Q$ is the sum of the $q$ places lying over $P^{(i-1)}$.
\end{enumerate}
\end{lemma}

Using this lemma, we are able to get the valuation at $P_{\infty}^{(i-1)}$ of every function $x_j$, for $0 \leq j \leq i-1$.

\begin{corollary} \label{val pinf}
Let $i \geq 1$. Then for $0 \leq j \leq i-1$, one have
\[\nu_{P_{\infty}^{(i-1)}}(x_j) = - q^{i-1-j}(q+1)^j.\]
\end{corollary}

Let $g_i:=g(F_i)$ denote the genus of $F_i$. An explicit formula was given by Pellikaan, Shen and Wee \cite[Proposition 4]{PSW91}. We have $g_0=0$ and for $i\geq 1$, 

\begin{equation}\label{eq:genus_herm}
	g_i =\dfrac{1}{2} \cd \left(\sum\limits_{k=1}^i q^{i+1} \cd \left(1+\frac{1}{q}\right)^{k-1} +1 -(1+q)^i\right).
\end{equation}

For every $i \geq 0$, the number of $\F_{q^2}$--rational places in $F_i$ is given by
\[N_i \mydef \#F_i(\F_{q^2}) = q^{i+2}+1.\]

In order to obtain a sequence of foldable codes, we need to describe the Riemann-Roch spaces on a certain step from Riemann-Roch spaces on lower curves. A priori that Kani's theorem does not apply, so we will have to find a decomposition by hand. In particular, it is reasonable to assume that the divisors associated with our codes are only supported by the single branched point, i.e. $P^{(i)}_{\infty}$. We therefore find ourselves having to study the behaviour of Riemann-Roch spaces of the form 
\[L_{F_i}\left(mP^{(i)}_{\infty}\right), \ pour \ i \geq 1.\] 


For a given $i \geq 0$, $P^{(i)}_{\infty}$ is the unique pole of the functions $x_0,...,x_i$, which gives an explicit basis of the Riemman-Roch space associated to a multiple of $P^{(i)}_{\infty}$.

\begin{lemma}\label{lem:basis_herm}
For all $i \leq 1$ and $m \leq 1$, we have 
\[L_{F_i}(mP^{(i)}_{\infty}) = \Span\left\{x_0^{a_0} \cdots x_i^{a_i} \ | \ 0 \leq a_0 \ , \ 0 \leq a_j \leq q-1 \text{ and } \sum\limits_{j=0}^i a_jq^{i-j}(q+1)^j \leq m \right\}.\]
\end{lemma}

\subsection{Construction of foldables AG-codes}

Let us fix $i \geq 0$. We aim to define a sequence of AG codes $C_i$ on the tower of curves $(\calX_i)_{i\geq 0}$ defined by 
\[C_i \mydef C_L(\calX_i,\calP_{i},G_i) \text{ where } \calP_{i} \subseteq \calX_i(\F_{q^2}) \setminus \{P_\infty^{(i)}\} \text{ and } D_i = d_iP^{(i)}_{\infty}.\]

Even though Kani's theorem does not hold, the basis of the Riemman-Roch space (Lemma \ref{lem:basis_herm}) enables us to get a similar decomposition, given in the following proposition.

\begin{proposition} 
	For $0 \leq j \leq q-1$, we set
	\[E_{i,j} \mydef \left\lfloor \frac{1}{q} \pi_{i*}\left(G_i-j(x_i)^{F_i}_{\infty}\right)\right\rfloor,\]
	where $\pi_i : F_i \rightarrow F_{i-1}$. Then 
\[L_{F_i}(D_i) = \bigoplus\limits_{j=0}^{q-1} x_i^j \pi_i^*\left(L_{F_{i-1}}(E_{i,j})\right).\]
\end{proposition}

Following the original definition of \cite{BN20}, we may define $D_{i-1}$ as $E_{i,0} = \left\lfloor \dfrac{d_i}{q} \right\rfloor \cd P^{(i-1)}_{\infty}$. This way, we get \todo{Donner un numéro/nom à cette cdt.}
\[D_{i-1} \geq E_{i,j} \ , \ pour \ tout \ 0 \leq j \leq q-1.\] 
However, to get foldable codes, we need the existence of balancing functions  $\nu_{i-1,j} \in F_{i-1}$ (for every  $0 \leq j \leq q-1$) such that 
\begin{equation}\label{eq:balancing_fct_herm}
	D_{i-1}-E_{i,j} = (\nu_{i-1,j})^{F_{i-1}}_{\infty}.
\end{equation}
In order to verify this conditions, on need to explicit the divisors $D_{i-1}-E_{i,j}$, that can easyly be done in our setup.

\begin{lemma} \label{divisor à équi}
For every $0 \leq j \leq q-1$, we have
\[E_{i,j} = \left\lfloor \dfrac{d_i-j(q+1)^i}{q}\right\rfloor \cd P^{(i-1)}_{\infty}.\]
Thus, we need to balance the divisors
\[D_{i-1}-E_{i,j} = \left(\left\lfloor \dfrac{d_i}{q} \right\rfloor - \left\lfloor \dfrac{d_i-j(q+1)^i}{q}\right\rfloor\right) \cd P^{(i-1)}_{\infty}.\]

\end{lemma}

From the previous lemma, it is clear that to find balancing functions, we are led to study the Weierstrass semigroup of $P^{(i-1)}_{\infty}$, denoted by $\calH\left(P^{(i-1)}_{\infty}\right)$. The generators of this semigroup can be found using Corollary \ref{val pinf}. In fact, $P_{\infty}^{(i-1)}$ is the unique commun pôle of the functions $x_0,...,x_{i-1} \in 
F_{i-1}$ and we know their exact valuation. Thus we have

\[\calH\left(P^{(i-1)}_{\infty}\right) = \left \langle q^{i-1-k}(q+1)^k \ , \ 0\leq k \leq i-1 \right\rangle_{\N}.\]

Therefore, choosing $D_{i-1}$ as $E_{i,0}$ would work if and only for every $0 \leq j \leq q-1$
\[ \left\lfloor \dfrac{d_i}{q} \right\rfloor - \left\lfloor \dfrac{d_i-j(q+1)^i}{q}\right\rfloor \in \calH\left(P^{(i-1)}_{\infty}\right).\]
However, when $i$ increases, this condition is never satisfied. We have to choose $D_{i-1}$ differently.  To ensure that 
$\deg(D_{i-1}-E_{i,j})$ is never a Weierstrass gap for $P_{\infty}^{(i-1)}$, we increase the degree $d_{i-1}$ of $D_{i-1}$. As we know that
\[\rm{max}\left(\N \backslash \calH\left(P^{(i-1)}_{\infty}\right)\right) \leq 2g_{i-1} -1,\]
see for example \cite{S08}, Theorem 1.6.8.
Thus, we define $D_{i-1}\mydef d_{i-1} P^{(i-1)}_{\infty}$ where
\begin{equation}\label{eq:deg_herm}
d_{i-1} \mydef \Floor{ \dfrac{d_i}{q}} + 2g_{i-1}.
\end{equation}


In this manner, we are sure to find balancing functions. In fact, the choice of degree in $(8)$ ensure that for every $0 \leq j \leq q-1$ 

\begin{equation}
m_{i,j}:=deg(D_{i-1}-E_{i,j}) =  \left(\left\lfloor \dfrac{d_i}{q} \right\rfloor - \left\lfloor \dfrac{d_i-j(q+1)^i}{q}\right\rfloor + 2g_{i-1} \right) \in \mathcal{H}\left(P_{\infty}^{(i-1)}\right).
\end{equation}

Since we know a $\mathbb{N}$-basis of the Weierstrass semigroup at $P_{\infty}^{(i-1)}$, we are able to explicit the form of the functions $\nu_{i-1,j}$. In particular, they can be chosen as product of monomials in the functions $x_0,...,x_{i-1}$. More precisly, if $a_{i,j} := (a_{i,j}(0),...,a_{i,j}(i-1)) \in \mathbb{N}^i$ are integers such that

\begin{equation}
m_{i,j} = \sum\limits_{k=0}^{i-1} a_{i,j}(k) \cd q^{i-1-k}(q+1)^k,
\end{equation}
then $m_{i,j} \in \mathcal{H}\left(P_{\infty}^{(i-1)}\right)$. The corresponding choice for the balancing function is then given by 
\[ \nu_{i-1,j} = \prod\limits_{k=0}^{i-1} x_k^{a_{i,j}(k)}.\]
Note that finding a vector $a_{i,j} \in \mathbb{N}^i$ satisfying $(10)$ leads to the study of the diophantine equation
\[m_{i,j} = \sum\limits_{k=0}^{i-1} a_k \cd q^{i-1-k}(q+1)^k\]
with $i$ unknowns $a_k \in \mathbb{N}$, for which there exist at least one solution (and we only need one).

Nevertheless, rising the degree of the divisor at each step has a counterpart. In fact, it also increase drastically the rate of the folded codes, and one must ensure that the code on $\mathbb{P}^1$ is not trivial, \textit{i.e.} of rate $< 1$. This will be the purpose of the next section. \\



\subsection{Majoration of the rate on $\mathbb{P}^1$ et searching for $\ii$}

Let us denote by $\ii$ the level in the tower $(\calX_i)_{i\geq 0}$, such that $\calX_{\ii}$ is the curve on which the code we want to test proximity is defined.

In order to control the rates of the different codes along the tower, let us first notice that they form an increasing sequence, and that the largest rate is that of the code Reed-Solomon code $\mathcal{C}_0$. In order to bound this rate from above, we shall compute the degree $d_0$ of the divisor $D_0$ on $\mathbb{P}^1$. \\

\begin{lemma}\label{lem:deg_herm}
for $1 \leq j \leq \ii$, we have 
\[d_{\ii -j} \leq \left\lfloor \dfrac{d_{\ii}}{q^j}\right\rfloor + \sum\limits_{k=1}^j \left\lfloor \dfrac{2g_{\ii -k}}{q^{j-k}}\right\rfloor + (j-1).\]
Hence 
\[d_0 \leq \left\lfloor \dfrac{d_{\ii}}{q^{\ii}}\right\rfloor + \sum\limits_{i=0}^{\ii-1} \left\lfloor \dfrac{2g_i}{q^{i}}\right\rfloor + \ii-1.\]

\end{lemma}

\begin{proof}
It follows from the definition of the degrees $d_i$ given in Equation \eqref{eq:deg_herm} and by induction on $j$.
\end{proof}

We are led to bound the genera $g_i$ for $i \leq \ii$. 

\begin{proposition}\label{prop:maj_genus_herm}
For $i \geq 1$, we have
\[g_i \leq \dfrac{q^{i+1}}{2} \sum\limits_{k=1}^i \binom{i}{k} \dfrac{1}{q^{k-1}} \leq \dfrac{iq^{i+1}}{2} \sum\limits_{k=1}^i \left(\dfrac{i}{q}\right)^{k-1} \leq \dfrac{i}{2}q^{i+1} + \dfrac{i(i-1)}{4}q^i,\]
the last inequality holding only if $i-1 < q$.
\end{proposition}

\begin{proof}
By Equation  \eqref{eq:genus_herm}, we have
\begin{align*}
g_i  &=\dfrac{1}{2} \cd \left(\sum\limits_{k=1}^i q^{i+1} \cd \left(1+\frac{1}{q}\right)^{k-1} +\underbrace{1 -(1+q)^i}_{\leq 0}\right) \\
	&\leq \dfrac{q^{i+1}}{2} \cd \left(\dfrac{1-(1+1/q)^i}{1-(1+1/q)}\right) \\
	& = \dfrac{q^{i+1}}{2} \cd q \cd ((1+1/q)^i-1) \\
	& = \dfrac{q^{i+1}}{2} \cd \sum\limits_{k=1}^i \binom{i}{k} \dfrac{1}{q^{k-1}}
\end{align*}
Note that if $k \geq 2$, then $\binom{i}{k} = \dfrac{i(i-1) \cdots (i-k+1)}{k(k-1) \cdots 2} \leq \dfrac{i(i-1)^{k-1}}{2}$, by bounding the denominator from below by $2$ and bounding the factors $i-1,i-2,...,i-k+1$ from above by $i-1$. We thus get
\begin{align*}
g_i &\leq \dfrac{q^{i+1}}{2} \cd \left( i + \frac{i}{2} \sum\limits_{k=2}^i \left(\dfrac{i-1}{q}\right)^{k-1}\right) \\
	&= \dfrac{iq^{i+1}}{2} \left( 1 + \frac{1}{2} \cd \left(\frac{i-1}{q}\right) \cd \left(\dfrac{1-(\frac{i-1}{q})^{i-1}}{1-(\frac{i-1}{q})}\right)\right) \\
		&= \dfrac{iq^{i+1}}{2} \left( 1 + \frac{1}{2q} \cd \dfrac{i-1}{q-i+1} \cd \left(1- \left(\dfrac{i-1}{q}\right)^{i-1}\right)\right)\end{align*}
Assuming that $i-1 < q$, we have $1- \left(\dfrac{i-1}{q}\right)^{i-1} \leq 1$ and $q-i+1 \geq 1$. Then we obtain 	
	\[g_i \leq \dfrac{iq^{i+1}}{2} \left( 1 + \frac{i-1}{2q}\right).\]
\end{proof}

We have now gathered all the ingredients to get an upperbound on $d_0$.

\begin{corollary}
The degree $d_0$ of the divisor $D_0$ on $\mathbb{P}^1$ is bounded from above by 
\[d_0 \leq \left\lfloor \dfrac{d_{\ii}}{q^{\ii}}\right\rfloor + (\ii-1)\left( 1+\dfrac{(\ii-1)}{2} \left(q-\frac{2}{3} + \frac{\ii}{3}\right) \right) \]
\end{corollary}

\begin{proof}
	By the formula of $d_0$ given in Lemma \ref{lem:deg_herm}, it is enough to bound the sum $\sum\limits_{k=0}^{\ii-1} \left\lfloor \dfrac{2g_k}{q^k}\right\rfloor$. By Proposition \ref{prop:maj_genus_herm},
\begin{align*}
\sum\limits_{k=0}^{\ii-1} \left\lfloor \dfrac{2g_k}{q^k}\right\rfloor & \leq  \sum\limits_{k=0}^{\ii-1} \left(kq + \dfrac{k(k-1)}{2}\right)  \\
	&= (q-\frac{1}{2}) \cd \dfrac{\ii(\ii-1)}{2} + \dfrac{\ii(\ii-1)(2\ii-1)}{12} \\
	&= \dfrac{\ii(\ii-1)}{2}\cd \left(q-\frac{2}{3} + \frac{\ii}{3}\right),
\end{align*}
which gives the expected result.
\end{proof}

According to the length of the code $C_{\ii}$, we can determine a sufficient condition on $\ii$ that ensures that the code $C_0$ is not trivial. The rate of $C_0$ is equal to $\dfrac{d_0+1}{n_0}$. The value of $n_0$ depends on $n_{\ii}$.

Let us assume that the code $C_{\ii}$ is obtained by evaluating on the whole set of $\F_{q^2}$--rational points, except for $P_\infty^{(\ii)}$, i.e. 
\[n_i := \#\calP_i = q^{i+2}.\]
Then $n_0=q^2$. 

\begin{corollary}\label{cor:cdt_deg_herm}
Let us fix $\rho \in (0,1)$. If
\[ \left\lfloor \dfrac{d_{\ii}}{q^{\ii}}\right\rfloor + \dfrac{\ii(\ii-1)}{2}\cd \left(q-\frac{2}{3} + \frac{\ii}{3}\right) + (\ii-1) < \rho q^2,\]
then the rate of the code $C_0$ is less than $\rho$.
\end{corollary}

\subsection{Families of foldable codes with constant rate}

\jade{Pour espérer avoir une famille de 'gros' codes à rendement constant, on va prendre un diviseur du haut avec un degré plus gros. la dépendance en le degré étant linéaire, ça devrait passer !}

\begin{proposition}
	Let us fix $\rho \in (0,1)$. Let us assume that $\ii =\sqrt{q}$ and that the divisor $G_{\ii}$ has degre $d_{\ii} = 2\kappa \sqrt{q}g_{\ii}$ for some $\kappa \in (0,1)$.
	Then the rate of \jade{the last RS code} is less than $\rho$.
\end{proposition}
\jade{J'ai mis un 2 dans le degré pour avoir un résultat plus joli...}
\begin{proof}
	Using Proposition \ref{prop:maj_genus_herm} to bound the genus from above, we have
	
	\[ \Floor{\dfrac{d_{\ii}}{q^{\ii}}} \leq  \kappa q \cd \left( q + \dfrac{\sqrt{q}-1}{2} \right)\]
	By Corollary \ref{cor:cdt_deg_herm}, a sufficient condition to have the designated rate is 
	\[\kappa q\cd \left( q + \dfrac{\sqrt{q}-1}{2} \right)+\dfrac{\sqrt{q}(\sqrt{q}-1)}{2}\cd \left(q-\frac{2}{3} + \frac{\sqrt{q}}{3}\right) + \sqrt{q}-1 < \rho q^2.\]
	The right hand--side term is an increasing function of $\kappa$. Therefore, if this inequality is satisfied for $\kappa=1$, it holds for every $\kappa \in (0,1)$. Simplifying this inequation, we get
		 
	%\[6(1+\kappa - 2) q^2 + (3\kappa-4)q\sqrt{q}-3(\kappa+2)q+16\sqrt{q}-12 <0.\]
	
	\[3(1+2\kappa - 2\rho) q^2 + (3\kappa-1)q\sqrt{q}-3(\kappa+1)q+8\sqrt{q}-6 <0.\]
	
	
	To prove that the above inequality is true for $\kappa=1$, it enough to note that the 3-degree polynomial function $-x^3-6x^2+16x-12$ takes negative value for any positive $x$.
\end{proof}


Take an integer $r$. Let us assume that $q=p^{2r}$ and take $\kappa=p^{-\ell}$ for an $0<\l<2r$. Then the code $C_L\left(F_{p^r},F_{p^r}( \F_{p^{4r}} )\setminus\{ {P_\infty}^{(p^r)} \}, \kappa p^3rP_\infty^{(p^r)}\right)$ is foldable. When $r \rightarrow \infty$, the rate of $\calC$ tends to $\dfrac{\kappa}{2}$ and its relative minimum distance is bounded from below by $1-\dfrac{\kappa}{2}-\dfrac{\kappa}{4p^r}$.



\begin{proposition}
	Let us fix $R, \rho \in (0,1)$. Let us assume that $\ii =\sqrt{q}$ and that the divisor $G_{\ii}$ has degre $d_{\ii} = 2\kappa \sqrt{q}g_{\ii}$ for some $\kappa \in (0,1)$.
	Then the rate of \jade{the last RS code} is less than $\rho$.
\end{proposition}




\newpage

\fr{On garde le tableau de tests ?}


\begin{center}
\begin{tabular}{|c|c|c|c|c|c|c|c|}
\hline
$q$ & $\ii$ & $n_{\ii}$ & $k_{\ii}$ & $n_0$ & $k_0$ & $\rho_0$ & majorant sur $\rho_0$ \\ 
\hline
8 & 3 & $2^{15}$ & $2^{12}$ & 64 & 49 & 0,766 & 0,844 \\
\hline
16 & 4 & $2^{24}$ & $2^{21}$ & 256 & 166 & 0,648 & 0,676 \\
\hline
27 & 6 & $2^{38}$ & $2^{34}$ & 729 & 597 & 0,819 & 0,833 \\
\hline
32 & 7 & $2^{45}$ & $2^{41}$ & 1024 & 947 & 0,925 & 0,936 \\
\hline
64 & 10 & $2^{72}$ & $2^{68}$ & 4096 & 3680 & 0,898 & 0,902 \\
\hline
\end{tabular}
\end{center}

\newpage

\bibliographystyle{alpha}
\bibliography{biblio_ag_ioppp_towers}




























\end{document}